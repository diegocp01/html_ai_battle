<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Flappy Square</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1e293b, #020617);
      color: #e5e7eb;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .game-wrapper {
      text-align: center;
      padding: 16px;
    }

    h1 {
      margin-bottom: 8px;
      letter-spacing: 1px;
      font-size: 1.6rem;
    }

    .game-container {
      position: relative;
      margin: 0 auto;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.6);
      border: 2px solid rgba(148, 163, 184, 0.5);
      background: linear-gradient(#38bdf8, #0ea5e9);
    }

    canvas {
      display: block;
      background: linear-gradient(#38bdf8, #0ea5e9);
    }

    .hud {
      position: absolute;
      top: 8px;
      left: 8px;
      right: 8px;
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
      font-weight: 600;
      color: #f9fafb;
      text-shadow: 0 0 4px rgba(0, 0, 0, 0.6);
      pointer-events: none;
    }

    .overlay {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at center, rgba(15, 23, 42, 0.4), rgba(15, 23, 42, 0.85));
      color: #f9fafb;
      text-shadow: 0 0 4px rgba(0, 0, 0, 0.7);
      padding: 16px;
    }

    .overlay-message {
      font-size: 1.1rem;
      margin-bottom: 12px;
      line-height: 1.4;
    }

    .overlay button {
      margin-top: 4px;
      padding: 8px 16px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 600;
      background: #22c55e;
      color: #022c22;
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.7);
      transition: transform 0.1s ease, box-shadow 0.1s ease, filter 0.1s ease;
    }

    .overlay button:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.8);
    }

    .overlay button:active {
      transform: translateY(1px);
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.7);
    }

    .hint {
      margin-top: 8px;
      font-size: 0.8rem;
      color: #cbd5f5;
      opacity: 0.8;
    }

    @media (max-width: 480px) {
      .game-container {
        width: 100vw;
        max-width: 420px;
      }
      canvas {
        width: 100%;
        height: auto;
      }
    }
  </style>
</head>
<body>
  <div class="game-wrapper">
    <h1>Flappy Square</h1>
    <div class="game-container">
      <canvas id="gameCanvas" width="400" height="600"></canvas>
      <div class="hud">
        <div>Score: <span id="score">0</span></div>
        <div>Best: <span id="best">0</span></div>
      </div>
      <div id="overlay" class="overlay">
        <div id="overlayMessage" class="overlay-message">
          Tap, click or press Space to flap.
        </div>
        <button id="startBtn" type="button">Start</button>
      </div>
    </div>
    <p class="hint">
      Controls: Space, â†‘ arrow, or tap / click to flap.
    </p>
  </div>

  <script>
    (function () {
      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");

      const overlay = document.getElementById("overlay");
      const overlayMessage = document.getElementById("overlayMessage");
      const startBtn = document.getElementById("startBtn");
      const scoreEl = document.getElementById("score");
      const bestEl = document.getElementById("best");

      const STATE = {
        READY: "ready",
        PLAYING: "playing",
        GAME_OVER: "game_over",
      };
      let gameState = STATE.READY;

      const bird = {
        x: canvas.width * 0.25,
        y: canvas.height / 2,
        radius: 15,
        velY: 0,
        gravity: 0.45,
        jump: -8.5,
        maxSpeed: 12,
      };

      const pipes = [];
      const pipeConfig = {
        width: 70,
        gap: 150,
        speed: 2.8,
        spawnIntervalFrames: 90,
        edgeMargin: 50,
      };

      let frameCount = 0;
      let score = 0;
      let bestScore = parseInt(localStorage.getItem("flappySquareBest") || "0", 10);

      bestEl.textContent = bestScore.toString();

      function resetGame() {
        bird.y = canvas.height / 2;
        bird.velY = 0;
        pipes.length = 0;
        frameCount = 0;
        score = 0;
        scoreEl.textContent = "0";
        pipeConfig.speed = 2.8;
        spawnPipe();
      }

      function spawnPipe() {
        const minGapTop = pipeConfig.edgeMargin;
        const maxGapTop = canvas.height - pipeConfig.edgeMargin - pipeConfig.gap;
        const gapTop = minGapTop + Math.random() * (maxGapTop - minGapTop);

        pipes.push({
          x: canvas.width + pipeConfig.width,
          gapTop: gapTop,
          gapBottom: gapTop + pipeConfig.gap,
          scored: false,
        });
      }

      function handleInput() {
        if (gameState === STATE.READY) {
          gameState = STATE.PLAYING;
          overlay.style.display = "none";
          bird.velY = bird.jump;
        } else if (gameState === STATE.PLAYING) {
          bird.velY = bird.jump;
        } else if (gameState === STATE.GAME_OVER) {
          resetGame();
          gameState = STATE.PLAYING;
          overlay.style.display = "none";
          bird.velY = bird.jump;
        }
      }

      startBtn.addEventListener("click", handleInput);

      document.addEventListener("keydown", function (e) {
        if (e.code === "Space" || e.code === "ArrowUp") {
          e.preventDefault();
          handleInput();
        }
      });

      canvas.addEventListener("pointerdown", function () {
        handleInput();
      });

      function update() {
        if (gameState !== STATE.PLAYING) {
          return;
        }

        frameCount++;

        // Bird physics
        bird.velY += bird.gravity;
        if (bird.velY > bird.maxSpeed) bird.velY = bird.maxSpeed;
        bird.y += bird.velY;

        // Spawn pipes
        if (frameCount % pipeConfig.spawnIntervalFrames === 0) {
          spawnPipe();
        }

        // Slight difficulty ramp
        if (frameCount % 600 === 0) {
          pipeConfig.speed += 0.2;
        }

        // Update pipes
        for (let i = pipes.length - 1; i >= 0; i--) {
          const p = pipes[i];
          p.x -= pipeConfig.speed;

          // Score when passing pipe
          if (!p.scored && p.x + pipeConfig.width < bird.x - bird.radius) {
            p.scored = true;
            score++;
            scoreEl.textContent = score.toString();
            if (score > bestScore) {
              bestScore = score;
              bestEl.textContent = bestScore.toString();
              localStorage.setItem("flappySquareBest", String(bestScore));
            }
          }

          // Remove off-screen pipes
          if (p.x + pipeConfig.width < 0) {
            pipes.splice(i, 1);
          }
        }

        // Collision detection
        if (bird.y - bird.radius <= 0 || bird.y + bird.radius >= canvas.height) {
          return endGame();
        }

        for (const p of pipes) {
          const inPipeX =
            bird.x + bird.radius > p.x && bird.x - bird.radius < p.x + pipeConfig.width;
          if (inPipeX) {
            const inGapY =
              bird.y - bird.radius > p.gapTop &&
              bird.y + bird.radius < p.gapBottom;
            if (!inGapY) {
              return endGame();
            }
          }
        }
      }

      function endGame() {
        gameState = STATE.GAME_OVER;
        overlay.style.display = "flex";
        overlayMessage.innerHTML =
          "Game Over<br>Score: " +
          score +
          "<br>Best: " +
          bestScore +
          "<br><br>Tap, click or press Space to try again.";
        startBtn.textContent = "Play again";
      }

      function drawBackground() {
        // Sky already from canvas background, just add ground
        const groundHeight = 60;
        ctx.fillStyle = "#0f172a";
        ctx.fillRect(0, canvas.height - groundHeight, canvas.width, groundHeight);

        // Simple ground pattern
        ctx.fillStyle = "#16a34a";
        ctx.fillRect(0, canvas.height - groundHeight, canvas.width, 10);
      }

      function drawPipes() {
        ctx.fillStyle = "#065f46";
        for (const p of pipes) {
          // Top pipe
          ctx.fillRect(p.x, 0, pipeConfig.width, p.gapTop);
          // Bottom pipe
          ctx.fillRect(
            p.x,
            p.gapBottom,
            pipeConfig.width,
            canvas.height - p.gapBottom
          );

          // Pipe lip
          ctx.fillStyle = "#047857";
          ctx.fillRect(p.x - 4, p.gapTop - 12, pipeConfig.width + 8, 12);
          ctx.fillRect(
            p.x - 4,
            p.gapBottom,
            pipeConfig.width + 8,
            12
          );
          ctx.fillStyle = "#065f46";
        }
      }

      function drawBird() {
        const grd = ctx.createRadialGradient(
          bird.x - 6,
          bird.y - 6,
          4,
          bird.x,
          bird.y,
          bird.radius + 4
        );
        grd.addColorStop(0, "#facc15");
        grd.addColorStop(1, "#ea580c");

        ctx.fillStyle = grd;
        ctx.beginPath();
        ctx.arc(bird.x, bird.y, bird.radius, 0, Math.PI * 2);
        ctx.fill();

        // Eye
        ctx.fillStyle = "#fff";
        ctx.beginPath();
        ctx.arc(bird.x + 6, bird.y - 4, 4, 0, Math.PI * 2);
        ctx.fill();

        ctx.fillStyle = "#000";
        ctx.beginPath();
        ctx.arc(bird.x + 7, bird.y - 4, 2, 0, Math.PI * 2);
        ctx.fill();

        // Beak
        ctx.fillStyle = "#f97316";
        ctx.beginPath();
        ctx.moveTo(bird.x + bird.radius, bird.y);
        ctx.lineTo(bird.x + bird.radius + 10, bird.y - 3);
        ctx.lineTo(bird.x + bird.radius + 10, bird.y + 3);
        ctx.closePath();
        ctx.fill();
      }

      function drawText() {
        if (gameState === STATE.READY) {
          ctx.fillStyle = "rgba(15,23,42,0.25)";
          ctx.font = "bold 24px system-ui";
          ctx.textAlign = "center";
          ctx.fillText("Tap or press Space", canvas.width / 2, canvas.height * 0.35);
          ctx.font = "16px system-ui";
          ctx.fillText("Fly between the pipes!", canvas.width / 2, canvas.height * 0.42);
        }
      }

      function loop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        drawBackground();
        drawPipes();
        drawBird();
        drawText();

        update();

        requestAnimationFrame(loop);
      }

      // Initial overlay text
      overlayMessage.innerHTML = "Tap, click or press Space to flap.";
      startBtn.textContent = "Start";

      resetGame();
      loop();
    })();
  </script>
</body>
</html>
